# Story 1.6: Task Creation & Inline Editing

## Status
Done

## Story
**As a** user,
**I want** to create and edit tasks quickly,
**so that** I can capture and refine my thoughts without friction.

## Acceptance Criteria

| # | Critério |
|---|----------|
| AC1 | Click em "+ Add task" cria nova task em modo edição |
| AC2 | Foco automático no input de título |
| AC3 | Enter salva task, Esc cancela |
| AC4 | Tasks vazias (sem título) não são salvas |
| AC5 | Click no título da task permite edição inline |
| AC6 | Click no card expande para mostrar descrição |
| AC7 | Descrição é editável (textarea) |
| AC8 | Mudanças salvam automaticamente (debounce 300ms) |

## Tasks / Subtasks

- [x] Task 1: Criar componente AddTaskButton funcional (AC1, AC2)
  - [x] Atualizar src/components/Board/Column.tsx
  - [x] Click cria task com título vazio em modo edição
  - [x] Focar automaticamente no input
- [x] Task 2: Criar componente TaskTitle editável (AC3, AC4, AC5)
  - [x] Criar src/components/Task/TaskTitle.tsx
  - [x] Modo display: texto simples
  - [x] Modo edição: input com foco
  - [x] Enter salva e sai do modo edição
  - [x] Esc cancela e restaura valor anterior
  - [x] Não salvar se título vazio (remover task)
- [x] Task 3: Implementar expand/collapse do card (AC6)
  - [x] Atualizar src/components/Task/TaskCard.tsx
  - [x] State isExpanded
  - [x] Click no card (não no título) expande
  - [x] Animação suave de altura
- [x] Task 4: Criar componente TaskDescription (AC7)
  - [x] Criar src/components/Task/TaskDescription.tsx
  - [x] Textarea editável
  - [x] Placeholder "Add description..."
  - [x] Auto-resize com conteúdo
- [x] Task 5: Implementar auto-save com debounce (AC8)
  - [x] Criar utility debounce em src/utils/debounce.ts
  - [x] Aplicar debounce 300ms no save
  - [x] Salvar título e descrição automaticamente
  - [x] Indicador visual de "saving..." (opcional)
- [x] Task 6: Integrar com useTasks hook
  - [x] createTask ao adicionar nova task
  - [x] updateTask ao editar título/descrição
  - [x] deleteTask se título vazio ao sair do modo edição

## Dev Notes

### Estados do Card (de PRD)
- **Default**: título + timer display (se houver tempo)
- **Hover**: mostra ações
- **Expanded**: mostra descrição editável

### Component Structure
```typescript
// TaskTitle.tsx
interface TaskTitleProps {
  task: Task;
  isEditing: boolean;
  onStartEdit: () => void;
  onSave: (title: string) => void;
  onCancel: () => void;
}

// TaskDescription.tsx
interface TaskDescriptionProps {
  description: string;
  onChange: (description: string) => void;
}
```

### Debounce Utility
```typescript
// src/utils/debounce.ts
export const debounce = <T extends (...args: any[]) => any>(
  fn: T,
  delay: number
): ((...args: Parameters<T>) => void) => {
  let timeoutId: NodeJS.Timeout;
  return (...args) => {
    clearTimeout(timeoutId);
    timeoutId = setTimeout(() => fn(...args), delay);
  };
};
```

### Keyboard Handling
```typescript
const handleKeyDown = (e: React.KeyboardEvent) => {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    onSave(value);
  }
  if (e.key === 'Escape') {
    onCancel();
  }
};
```

### Testing
- Criar nova task funciona
- Editar título inline funciona
- Expandir card mostra descrição
- Tasks vazias são descartadas
- Dados persistem após edição

## Definition of Done
- [x] Criar nova task funciona
- [x] Editar título inline funciona
- [x] Expandir card mostra descrição
- [x] Tasks vazias são descartadas
- [x] Dados persistem após edição

## Story Points
4

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-31 | 0.1 | Story criada a partir do PRD | River (SM) |
| 2026-01-31 | 1.0 | Implementation complete | Dex (Dev) |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References
N/A - Implementation completed without issues

### Completion Notes List
1. Created debounce utility with cancel() method for cleanup
2. Created TaskTitle component with inline editing, keyboard handling (Enter/Esc), and empty title deletion
3. Created TaskDescription component with auto-resize textarea
4. Updated TaskCard with expand/collapse functionality and integrated new components
5. Updated Column component to make "+ Add task" button functional
6. All components properly integrate with existing useTasks hook (createTask, updateTask, deleteTask)
7. Debounce (300ms) applied to description changes for auto-save
8. Title saves immediately on Enter/blur, not debounced (for better UX)

### File List
- `C:\dev\miplan\src\utils\debounce.ts` (NEW) - Debounce utility function with cancel support
- `C:\dev\miplan\src\components\Task\TaskTitle.tsx` (NEW) - Inline editable title component
- `C:\dev\miplan\src\components\Task\TaskDescription.tsx` (NEW) - Auto-resizing editable description textarea
- `C:\dev\miplan\src\components\Task\TaskCard.tsx` (MODIFIED) - Added expand/collapse, integrated TaskTitle and TaskDescription
- `C:\dev\miplan\src\components\Board\Column.tsx` (MODIFIED) - Made "+ Add task" button functional

---

## QA Results
*To be filled by QA agent*
