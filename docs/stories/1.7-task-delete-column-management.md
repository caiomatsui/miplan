# Story 1.7: Task Delete & Column Management

## Status
Done

## Story
**As a** user,
**I want** to manage tasks and columns,
**so that** I can customize my workflow.

## Acceptance Criteria

| # | Critério |
|---|----------|
| AC1 | Botão delete em cada task (visível no hover) |
| AC2 | ConfirmDialog antes de deletar task |
| AC3 | Click em "+ Add column" adiciona nova coluna |
| AC4 | Nova coluna criada com nome "New Column" em modo edição |
| AC5 | Click no título da coluna permite renomear |
| AC6 | Menu de coluna com opção "Delete column" |
| AC7 | Deletar coluna move tasks para coluna anterior ou deleta junto |
| AC8 | Drag-and-drop para reordenar colunas |
| AC9 | Mínimo de 1 coluna (não pode deletar a última) |

## Tasks / Subtasks

- [x] Task 1: Criar componente TaskActions (AC1)
  - [x] Criar src/components/Task/TaskActions.tsx
  - [x] Botão delete (ícone trash)
  - [x] Visível apenas no hover do card
  - [x] Posicionar no canto superior direito
- [x] Task 2: Implementar delete task com confirmação (AC2)
  - [x] Usar ConfirmDialog component
  - [x] Mensagem: "Delete this task?"
  - [x] Chamar deleteTask do hook
- [x] Task 3: Tornar AddColumn funcional (AC3, AC4)
  - [x] Atualizar src/components/Board/AddColumn.tsx
  - [x] Click cria coluna com título "New Column"
  - [x] Coluna entra em modo edição automático
  - [x] Focar no input de título
- [x] Task 4: Tornar ColumnHeader editável (AC5)
  - [x] Atualizar src/components/Board/ColumnHeader.tsx
  - [x] Click no título entra em modo edição
  - [x] Input inline similar ao TaskTitle
  - [x] Enter salva, Esc cancela
- [x] Task 5: Criar ColumnMenu (AC6)
  - [x] Criar src/components/Board/ColumnMenu.tsx
  - [x] Botão "..." no header da coluna
  - [x] Dropdown com opção "Delete column"
  - [x] Fechar ao clicar fora
- [x] Task 6: Implementar delete column (AC7, AC9)
  - [x] Verificar se é a última coluna (bloquear)
  - [x] ConfirmDialog com opções:
    - "Delete tasks too"
    - "Move tasks to previous column"
  - [x] Implementar lógica de mover tasks
- [x] Task 7: Implementar drag-and-drop de colunas (AC8)
  - [x] Adicionar SortableContext para colunas
  - [x] Usar horizontalListSortingStrategy
  - [x] Tornar Column draggable pelo header
  - [x] Persistir nova ordem

## Dev Notes

### Component Files
```
src/components/Task/
├── TaskCard.tsx
├── TaskTitle.tsx
├── TaskDescription.tsx
├── TaskTimer.tsx (futuro)
└── TaskActions.tsx    ← novo

src/components/Board/
├── Board.tsx
├── Column.tsx
├── ColumnHeader.tsx   ← atualizar
├── ColumnMenu.tsx     ← novo
└── AddColumn.tsx      ← atualizar
```

### TaskActions Component
```typescript
interface TaskActionsProps {
  taskId: string;
  onDelete: () => void;
}

export const TaskActions = ({ taskId, onDelete }: TaskActionsProps) => {
  const [showConfirm, setShowConfirm] = useState(false);

  return (
    <>
      <button onClick={() => setShowConfirm(true)}>
        <TrashIcon />
      </button>
      <ConfirmDialog
        isOpen={showConfirm}
        title="Delete Task"
        message="Are you sure you want to delete this task?"
        onConfirm={onDelete}
        onCancel={() => setShowConfirm(false)}
      />
    </>
  );
};
```

### Column Drag Setup
```typescript
// No Board.tsx, adicionar SortableContext para colunas
<SortableContext
  items={columns.map(c => c.id)}
  strategy={horizontalListSortingStrategy}
>
  {columns.map(column => (
    <SortableColumn key={column.id} column={column} />
  ))}
</SortableContext>
```

### Delete Column Logic
```typescript
const deleteColumn = async (columnId: string, moveTasksTo?: string) => {
  const columns = await db.columns.where('boardId').equals(boardId).toArray();

  if (columns.length <= 1) {
    throw new Error('Cannot delete the last column');
  }

  await db.transaction('rw', db.columns, db.tasks, async () => {
    if (moveTasksTo) {
      await db.tasks.where('columnId').equals(columnId)
        .modify({ columnId: moveTasksTo });
    } else {
      await db.tasks.where('columnId').equals(columnId).delete();
    }
    await db.columns.delete(columnId);
  });
};
```

### Testing
- Deletar task com confirmação funciona
- Criar nova coluna funciona
- Renomear coluna funciona
- Deletar coluna funciona (com tasks)
- Reordenar colunas funciona
- Não pode deletar última coluna

## Definition of Done
- [x] Deletar task com confirmação funciona
- [x] Criar nova coluna funciona
- [x] Renomear coluna funciona
- [x] Deletar coluna funciona (com tasks)
- [x] Reordenar colunas funciona
- [x] Não pode deletar última coluna

## Story Points
4

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-31 | 0.1 | Story criada a partir do PRD | River (SM) |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 (claude-opus-4-5-20251101) - Dex (Dev Agent)

### Debug Log References
N/A - Implementation completed successfully

### Completion Notes List
1. Created TaskActions component with delete button and ConfirmDialog integration
2. TaskCard already integrated TaskActions (visible on hover in top-right corner)
3. Made AddColumn functional - creates column with "New Column" title and triggers edit mode
4. Made ColumnHeader editable with click-to-edit, Enter saves, Esc cancels
5. Created ColumnMenu with dropdown containing "Delete column" option
6. Implemented delete column logic with:
   - Block deletion of last column (disabled button with tooltip)
   - Modal for columns with tasks offering: "Move tasks to previous column" or "Delete tasks too"
7. Implemented column drag-and-drop using horizontalListSortingStrategy with SortableContext
8. Created ColumnOverlay for drag overlay visual feedback
9. All components use existing hooks (useColumnActions, useTaskActions) and UI components (ConfirmDialog, Modal, Button)

### File List
**New Files Created:**
- `src/components/Task/TaskActions.tsx` - Delete button component with ConfirmDialog
- `src/components/Board/ColumnMenu.tsx` - Dropdown menu for column actions (delete)
- `src/components/Board/ColumnOverlay.tsx` - Overlay component for column drag visual

**Files Updated:**
- `src/components/Board/AddColumn.tsx` - Made functional with createColumn hook
- `src/components/Board/ColumnHeader.tsx` - Added editable title, drag handle, menu slot
- `src/components/Board/Column.tsx` - Added sortable column support, integrated ColumnMenu and editable header
- `src/components/Board/Board.tsx` - Added SortableContext for columns with horizontalListSortingStrategy, column drag handling

---

## QA Results
*To be filled by QA agent*
