# Story 2.1: Multi-Board Data Model & Selector

## Status
Done

## Story
**As a** user,
**I want** to have multiple boards,
**so that** I can organize different projects or contexts separately.

## Acceptance Criteria

| # | Critério |
|---|----------|
| AC1 | Data model suporta múltiplos boards independentes |
| AC2 | Sidebar exibe lista de boards disponíveis |
| AC3 | Click no nome do board alterna para ele |
| AC4 | Board ativo é visualmente destacado (bullet preenchido) |
| AC5 | Primeiro board criado automaticamente na primeira visita |
| AC6 | Trocar de board carrega columns e tasks corretas |
| AC7 | State do board ativo persiste (reabrir app volta ao último) |

## Tasks / Subtasks

- [x] Task 1: Verificar data model (AC1)
  - [x] Confirmar que Dexie schema suporta múltiplos boards
  - [x] Confirmar relações Board → Columns → Tasks via boardId
  - [x] Testar criação de múltiplos boards
- [x] Task 2: Criar componente BoardList (AC2)
  - [x] Criar src/components/Sidebar/BoardList.tsx
  - [x] Listar todos os boards do database
  - [x] Usar useLiveQuery para reatividade
- [x] Task 3: Criar componente BoardItem (AC3, AC4)
  - [x] Criar src/components/Sidebar/BoardItem.tsx
  - [x] Exibir nome do board
  - [x] Indicador visual se ativo (bullet ● vs ○)
  - [x] Click chama setActiveBoard
- [x] Task 4: Integrar BoardList na Sidebar (AC2)
  - [x] Atualizar src/components/Sidebar/Sidebar.tsx
  - [x] Adicionar BoardList abaixo do título
  - [x] Estilo consistente com design minimalista
- [x] Task 5: Implementar troca de board (AC3, AC6)
  - [x] setActiveBoard atualiza store
  - [x] Board component recarrega columns e tasks
  - [x] Usar activeBoardId do Zustand store
- [x] Task 6: Criar board default (AC5)
  - [x] No App.tsx, verificar se existem boards
  - [x] Se não existir, criar "My Board" tipo kanban
  - [x] Setar como activeBoard automaticamente
- [x] Task 7: Persistir board ativo (AC7)
  - [x] activeBoardId já está no persist middleware
  - [x] Verificar que funciona no refresh
  - [x] Se board foi deletado, fallback para primeiro disponível

## Dev Notes

### Zustand Store (já definido em 1.3)
```typescript
interface UIState {
  activeBoardId: string | null;
  // ...
}

interface UIActions {
  setActiveBoard: (id: string) => void;
  // ...
}
```

### BoardList Component
```typescript
import { useLiveQuery } from 'dexie-react-hooks';
import { db } from '../../db';
import { useAppStore } from '../../store';
import { BoardItem } from './BoardItem';

export const BoardList = () => {
  const boards = useLiveQuery(() => db.boards.toArray());
  const activeBoardId = useAppStore(state => state.activeBoardId);
  const setActiveBoard = useAppStore(state => state.setActiveBoard);

  return (
    <ul className="space-y-1">
      {boards?.map(board => (
        <BoardItem
          key={board.id}
          board={board}
          isActive={board.id === activeBoardId}
          onClick={() => setActiveBoard(board.id)}
        />
      ))}
    </ul>
  );
};
```

### BoardItem Component
```typescript
interface BoardItemProps {
  board: Board;
  isActive: boolean;
  onClick: () => void;
}

export const BoardItem = ({ board, isActive, onClick }: BoardItemProps) => {
  return (
    <li>
      <button
        onClick={onClick}
        className={`w-full text-left px-2 py-1 rounded ${
          isActive ? 'bg-gray-100 font-medium' : 'hover:bg-gray-50'
        }`}
      >
        <span className="mr-2">{isActive ? '●' : '○'}</span>
        {board.name}
      </button>
    </li>
  );
};
```

### Default Board Creation
```typescript
// No App.tsx ou hook dedicado
useEffect(() => {
  const initDefaultBoard = async () => {
    const count = await db.boards.count();
    if (count === 0) {
      const boardId = await createBoard('My Board', 'kanban');
      setActiveBoard(boardId);
    } else if (!activeBoardId) {
      const firstBoard = await db.boards.orderBy('createdAt').first();
      if (firstBoard) setActiveBoard(firstBoard.id);
    }
  };
  initDefaultBoard();
}, []);
```

### Testing
- Múltiplos boards aparecem na sidebar
- Clicar em board diferente alterna view
- Cada board tem suas próprias columns/tasks
- Último board ativo restaura no refresh

## Definition of Done
- [x] Múltiplos boards aparecem na sidebar
- [x] Clicar em board diferente alterna view
- [x] Cada board tem suas próprias columns/tasks
- [x] Último board ativo restaura no refresh

## Story Points
3

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-31 | 0.1 | Story criada a partir do PRD | River (SM) |
| 2026-01-31 | 1.0 | Implementation complete - all ACs verified | Dex (Dev) |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 (claude-opus-4-5-20251101) - Dex Dev Agent

### Debug Log References
N/A - No debug issues encountered

### Completion Notes List
1. **Task 1 (Data Model)**: Verified Dexie schema already supports multiple boards with proper indexes (`id, type, createdAt`). Board, Column, and Task types have proper `boardId` relationships for data isolation.

2. **Task 2 (BoardList)**: Created `BoardList.tsx` component using `useLiveQuery` from `dexie-react-hooks` for reactive board listing. Component properly handles empty state.

3. **Task 3 (BoardItem)**: Created `BoardItem.tsx` component with visual indicator (filled bullet `●` for active, empty bullet `○` for inactive). Click handler properly calls `setActiveBoard`.

4. **Task 4 (Sidebar Integration)**: Refactored `Sidebar.tsx` to use the new `BoardList` component, removing inline board rendering logic. Clean separation of concerns.

5. **Task 5 (Board Switching)**: Already implemented - `Board.tsx` uses `activeBoardId` from Zustand store. `useColumns` and `useTasks` hooks filter by `boardId` ensuring proper data isolation.

6. **Task 6 (Default Board)**: Already implemented in `App.tsx` - creates "My Board" with kanban template columns on first visit using `initializeDefaultBoard` effect.

7. **Task 7 (Persistence)**: Already implemented - `useUIStore` uses Zustand's `persist` middleware with `name: 'miplan-ui-storage'`. Fallback logic in `App.tsx` handles deleted boards.

### File List
| File | Action |
|------|--------|
| `src/components/Sidebar/BoardList.tsx` | Created |
| `src/components/Sidebar/BoardItem.tsx` | Created |
| `src/components/Sidebar/Sidebar.tsx` | Modified (refactored to use BoardList) |
| `src/db/index.ts` | Verified (no changes needed) |
| `src/store/index.ts` | Verified (no changes needed) |
| `src/hooks/useBoard.ts` | Verified (no changes needed) |
| `src/hooks/useColumns.ts` | Verified (no changes needed) |
| `src/hooks/useTasks.ts` | Verified (no changes needed) |
| `src/App.tsx` | Verified (no changes needed) |
| `src/components/Board/Board.tsx` | Verified (no changes needed) |

---

## QA Results
*To be filled by QA agent*
