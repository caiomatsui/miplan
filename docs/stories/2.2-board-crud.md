# Story 2.2: Board CRUD

## Status
Done

## Story
**As a** user,
**I want** to create, rename, and delete boards,
**so that** I can manage my workspaces.

## Acceptance Criteria

| # | Critério |
|---|----------|
| AC1 | Botão "+ New Board" no final da lista de boards |
| AC2 | Modal para criar board com: nome e tipo (dropdown) |
| AC3 | Tipos disponíveis: "Kanban" (default) e "Study Planner" |
| AC4 | Board criado com colunas default do template |
| AC5 | Double-click no nome do board permite renomear |
| AC6 | Menu de contexto ou botão para deletar board |
| AC7 | Confirmação antes de deletar board |
| AC8 | Não é possível deletar o último board |
| AC9 | Após deletar, navega para outro board |

## Tasks / Subtasks

- [x] Task 1: Criar AddBoardButton (AC1)
  - [x] Criar src/components/Sidebar/AddBoardButton.tsx
  - [x] Posicionar no final da lista de boards
  - [x] Estilo consistente com design
- [x] Task 2: Criar CreateBoardModal (AC2, AC3)
  - [x] Criar src/components/Board/CreateBoardModal.tsx
  - [x] Input para nome do board
  - [x] Dropdown para tipo (Kanban/Study Planner)
  - [x] Botões Criar e Cancelar
  - [x] Validação: nome não pode ser vazio
- [x] Task 3: Implementar criação de board (AC4)
  - [x] Usar createBoard do useBoard hook
  - [x] Criar colunas do template correspondente
  - [x] Setar novo board como ativo
  - [x] Fechar modal após criação
- [x] Task 4: Criar boardTemplates (AC3, AC4)
  - [x] Criar src/constants/boardTemplates.ts
  - [x] Template Kanban: To Do, In Progress, Done
  - [x] Template Study Planner: Planejamento, Seg-Dom, Finalizado, Favoritos
- [x] Task 5: Implementar rename board (AC5)
  - [x] Atualizar BoardItem para suportar double-click
  - [x] Modo edição inline similar a ColumnHeader
  - [x] Enter salva, Esc cancela
- [x] Task 6: Implementar delete board (AC6, AC7, AC8, AC9)
  - [x] Adicionar botão delete no BoardItem (hover)
  - [x] Ou menu de contexto (right-click)
  - [x] ConfirmDialog: "Delete board and all its tasks?"
  - [x] Verificar se é último board (bloquear)
  - [x] Após deletar, navegar para próximo board

## Dev Notes

### Board Templates (de architecture.md)
```typescript
// src/constants/boardTemplates.ts
import { BoardTemplate } from '../types';

export const BOARD_TEMPLATES: Record<string, BoardTemplate> = {
  kanban: {
    type: 'kanban',
    name: 'Kanban Board',
    columns: ['To Do', 'In Progress', 'Done'],
  },
  'study-planner': {
    type: 'study-planner',
    name: 'Study Planner',
    columns: [
      'Planejamento',
      'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sab', 'Dom',
      'Finalizado',
      'Favoritos',
    ],
  },
};
```

### CreateBoardModal Component
```typescript
interface CreateBoardModalProps {
  isOpen: boolean;
  onClose: () => void;
}

export const CreateBoardModal = ({ isOpen, onClose }: CreateBoardModalProps) => {
  const [name, setName] = useState('');
  const [type, setType] = useState<'kanban' | 'study-planner'>('kanban');

  const handleCreate = async () => {
    if (!name.trim()) return;
    const boardId = await createBoard(name, type);
    setActiveBoard(boardId);
    onClose();
  };

  return (
    <Modal isOpen={isOpen} onClose={onClose} title="Create New Board">
      <Input
        label="Board Name"
        value={name}
        onChange={e => setName(e.target.value)}
        placeholder="My Board"
      />
      <select value={type} onChange={e => setType(e.target.value)}>
        <option value="kanban">Kanban</option>
        <option value="study-planner">Study Planner</option>
      </select>
      <Button onClick={handleCreate}>Create</Button>
    </Modal>
  );
};
```

### Delete Board Logic
```typescript
const deleteBoard = async (boardId: string) => {
  const boards = await db.boards.toArray();

  if (boards.length <= 1) {
    throw new Error('Cannot delete the last board');
  }

  await db.transaction('rw', db.boards, db.columns, db.tasks, async () => {
    // Delete all tasks of this board
    await db.tasks.where('boardId').equals(boardId).delete();
    // Delete all columns of this board
    await db.columns.where('boardId').equals(boardId).delete();
    // Delete the board
    await db.boards.delete(boardId);
  });

  // Navigate to another board
  const remainingBoards = boards.filter(b => b.id !== boardId);
  if (remainingBoards.length > 0) {
    setActiveBoard(remainingBoards[0].id);
  }
};
```

### Testing
- Criar board Kanban funciona
- Criar board Study Planner funciona
- Renomear board funciona
- Deletar board com confirmação funciona
- Não pode deletar último board

## Definition of Done
- [x] Criar board Kanban funciona
- [x] Criar board Study Planner funciona
- [x] Renomear board funciona
- [x] Deletar board com confirmação funciona
- [x] Não pode deletar último board

## Story Points
4

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-31 | 0.1 | Story criada a partir do PRD | River (SM) |
| 2026-01-31 | 1.0 | Implementation completed | Dex (Dev) |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References
N/A

### Completion Notes List
- Created AddBoardButton component for "+ New Board" functionality
- Created CreateBoardModal with board name input and type dropdown (Kanban/Study Planner)
- Board creation uses existing boardTemplates.ts for default columns
- Updated BoardItem to support double-click renaming with inline editing
- Added delete button on hover with ConfirmDialog confirmation
- Delete is blocked when there is only one board remaining
- After deletion, automatically navigates to another available board
- Updated BoardList to integrate AddBoardButton and CreateBoardModal

### File List
- `src/components/Sidebar/AddBoardButton.tsx` (created)
- `src/components/Board/CreateBoardModal.tsx` (created)
- `src/components/Sidebar/BoardItem.tsx` (updated - added rename/delete)
- `src/components/Sidebar/BoardList.tsx` (updated - integrated new components)
- `src/constants/boardTemplates.ts` (already existed - used for templates)

---

## QA Results
*To be filled by QA agent*
