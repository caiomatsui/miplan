# Story 3.1: Import Tasks from .txt File

## Status
Done

## Story
**As a** user,
**I want** to import tasks from a .txt file,
**so that** I can quickly create multiple tasks from my saved links/notes.

## Acceptance Criteria

| # | Crit√©rio |
|---|----------|
| AC1 | Bot√£o "Import" no header abre modal |
| AC2 | Modal com √°rea de drag-and-drop para arquivo .txt |
| AC3 | Alternativa: textarea para colar texto diretamente |
| AC4 | Parser: cada linha vira uma task (t√≠tulo = conte√∫do) |
| AC5 | Linhas vazias s√£o ignoradas |
| AC6 | Step 2: preview das tasks com checkboxes |
| AC7 | Seletor de coluna destino (default: primeira coluna) |
| AC8 | Indicador visual de URLs detectadas (üîó) |
| AC9 | Bot√£o "Import X tasks" cria tasks |
| AC10 | Toast de sucesso: "X tasks importadas" |

## Tasks / Subtasks

- [x] Task 1: Adicionar bot√£o Import no Header (AC1)
  - [x] Atualizar src/components/Header/Header.tsx
  - [x] Bot√£o "Import" ou √≠cone √† direita
  - [x] Click abre ImportModal
- [x] Task 2: Criar ImportModal (AC2, AC3)
  - [x] Criar src/components/Import/ImportModal.tsx
  - [x] Step 1: File upload ou paste
  - [x] Step 2: Preview e sele√ß√£o
  - [x] Step 3: Confirmar import
- [x] Task 3: Criar FileDropzone (AC2)
  - [x] Criar src/components/Import/FileDropzone.tsx
  - [x] √Årea de drag-and-drop visual
  - [x] Aceitar apenas .txt
  - [x] Feedback visual ao arrastar arquivo
  - [x] Ler conte√∫do do arquivo
- [x] Task 4: Criar textarea alternativa (AC3)
  - [x] Textarea para colar texto
  - [x] Placeholder com instru√ß√µes
  - [x] Tabs ou toggle entre file/paste
- [x] Task 5: Criar parser de texto (AC4, AC5)
  - [x] Criar src/utils/import.ts
  - [x] parseTextFile(content): ParsedLine[]
  - [x] Split por \n, trim cada linha
  - [x] Filtrar linhas vazias
  - [x] Detectar URLs em cada linha
- [x] Task 6: Criar ImportPreview (AC6, AC8)
  - [x] Criar src/components/Import/ImportPreview.tsx
  - [x] Lista de items com checkboxes
  - [x] Marcar/desmarcar items individualmente
  - [x] Select all / Deselect all
  - [x] √çcone üîó para linhas com URL
- [x] Task 7: Criar seletor de coluna (AC7)
  - [x] Dropdown com colunas do board ativo
  - [x] Default: primeira coluna
  - [x] Atualizar ao trocar board (se permitido)
- [x] Task 8: Implementar import (AC9)
  - [x] Criar tasks para items selecionados
  - [x] Usar coluna destino selecionada
  - [x] Ordem: append no final da coluna
  - [x] Fechar modal ap√≥s sucesso
- [x] Task 9: Criar Toast component (AC10)
  - [x] Criar src/components/ui/Toast.tsx
  - [x] Mensagem tempor√°ria (3s)
  - [x] Posi√ß√£o: bottom-right
  - [x] "X tasks importadas"

## Dev Notes

### Parser Logic (de architecture.md)
```typescript
// src/utils/import.ts
export interface ParsedLine {
  title: string;
  hasUrl: boolean;
  selected: boolean;
}

export const parseTextFile = (content: string): ParsedLine[] => {
  return content
    .split('\n')
    .map(line => line.trim())
    .filter(line => line.length > 0)
    .map(line => ({
      title: line,
      hasUrl: /https?:\/\/|www\./i.test(line),
      selected: true
    }));
};
```

### ImportModal Flow
```
Step 1: Upload/Paste
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  [Drop .txt file here]         ‚îÇ
‚îÇ       or                       ‚îÇ
‚îÇ  [Paste text below]            ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ textarea                 ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ  [Next ‚Üí]                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Step 2: Preview
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Column: [Select column ‚ñº]     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ ‚òë Line 1           üîó   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚òë Line 2                ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚òë Line 3           üîó   ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ  [Import 3 tasks]              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### FileDropzone Component
```typescript
interface FileDropzoneProps {
  onFileRead: (content: string) => void;
}

export const FileDropzone = ({ onFileRead }: FileDropzoneProps) => {
  const handleDrop = (e: React.DragEvent) => {
    e.preventDefault();
    const file = e.dataTransfer.files[0];
    if (file && file.name.endsWith('.txt')) {
      const reader = new FileReader();
      reader.onload = (e) => {
        onFileRead(e.target?.result as string);
      };
      reader.readAsText(file);
    }
  };

  return (
    <div
      onDrop={handleDrop}
      onDragOver={(e) => e.preventDefault()}
      className="border-2 border-dashed rounded-lg p-8 text-center"
    >
      Drop .txt file here
    </div>
  );
};
```

### Testing
- Upload de arquivo .txt funciona
- Colar texto funciona
- Preview mostra todas as linhas
- URLs s√£o identificadas com √≠cone
- Import cria tasks na coluna selecionada
- Toast de sucesso aparece

## Definition of Done
- [x] Upload de arquivo .txt funciona
- [x] Colar texto funciona
- [x] Preview mostra todas as linhas
- [x] URLs s√£o identificadas com √≠cone
- [x] Import cria tasks na coluna selecionada
- [x] Toast de sucesso aparece

## Story Points
5

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-31 | 0.1 | Story criada a partir do PRD | River (SM) |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References
N/A - Implementation completed without debug issues

### Completion Notes List
- Implemented complete import workflow with two-step modal (upload/paste then preview)
- FileDropzone supports drag-and-drop and click-to-browse for .txt files
- Parser correctly splits by newline, trims whitespace, and filters empty lines
- URL detection using regex pattern for http://, https://, and www.
- Preview shows checkboxes with select all/deselect all functionality
- Link icon displayed for lines containing URLs
- Column selector defaults to first column with dropdown for all board columns
- Tasks created sequentially to maintain order, appended at end of column
- Toast notification shows success message with count of imported tasks
- Toast auto-dismisses after 3 seconds, positioned at bottom-right

### File List
**New Files Created:**
- `C:\dev\miplan\src\utils\import.ts` - ParsedLine interface and parseTextFile, isValidTextFile, readFileAsText utilities
- `C:\dev\miplan\src\components\Import\ImportModal.tsx` - Main import modal with two-step flow
- `C:\dev\miplan\src\components\Import\FileDropzone.tsx` - Drag-and-drop file upload component
- `C:\dev\miplan\src\components\Import\ImportPreview.tsx` - Preview list with checkboxes and column selector
- `C:\dev\miplan\src\components\Import\index.ts` - Barrel export file
- `C:\dev\miplan\src\components\ui\Toast.tsx` - Toast notification component

**Modified Files:**
- `C:\dev\miplan\src\App.tsx` - Added ImportModal and Toast components
- `C:\dev\miplan\src\store\index.ts` - Added toast state (ToastMessage interface, showToast/hideToast actions)
- `C:\dev\miplan\src\index.css` - Added slide-up animation for Toast

---

## QA Results
*To be filled by QA agent*
